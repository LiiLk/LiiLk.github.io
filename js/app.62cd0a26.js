(function(){"use strict";var e={5785:function(e,t,n){var o=n(9242),r=n(3396);const a=(0,r._)("link",{rel:"stylesheet",href:"https://unpkg.com/primeflex@^3/primeflex.css"},null,-1);function i(e,t,n,o,i,c){const s=(0,r.up)("HeaderComponent"),u=(0,r.up)("router-view");return(0,r.wg)(),(0,r.iD)(r.HY,null,[a,(0,r.Wm)(s,{onNavigate:e.navigateTo},null,8,["onNavigate"]),(0,r.Wm)(u)],64)}n(7658);const c={class:"card relative z-2"},s=(0,r._)("a",{href:"http://localhost:8080/"},[(0,r._)("img",{alt:"logo",src:"https://i.postimg.cc/jqP7JhJf/image.png",height:"40",class:"mr-2"})],-1);function u(e,t,n,o,a,i){const u=(0,r.up)("InputText"),l=(0,r.up)("Menubar");return(0,r.wg)(),(0,r.iD)("div",c,[(0,r.Wm)(l,{model:a.items},{start:(0,r.w5)((()=>[s])),end:(0,r.w5)((()=>[(0,r.Wm)(u,{placeholder:"Search",type:"text"})])),_:1},8,["model"])])}var l=n(5106),p={name:"HeaderComponent",components:{Menubar:l.Z},data(){return{items:[{label:"Liste des produits",icon:"pi pi-fw pi-file",command:()=>{this.$emit("navigate","ProductList")}},{label:"Modification de produit",icon:"pi pi-fw pi-info-circle",command:()=>{this.$emit("navigate","ProductDetails")}},{label:"Rapport financier",icon:"pi pi-fw pi-pencil"},{label:"Users",icon:"pi pi-fw pi-user",items:[{label:"New",icon:"pi pi-fw pi-user-plus"},{label:"Delete",icon:"pi pi-fw pi-user-minus"},{label:"Search",icon:"pi pi-fw pi-users",items:[{label:"Filter",icon:"pi pi-fw pi-filter",items:[{label:"Print",icon:"pi pi-fw pi-print"}]},{icon:"pi pi-fw pi-bars",label:"List"}]}]},{label:"Categorie",icon:"pi pi-fw pi-calendar",items:[{label:"Crustace",icon:"pi pi-fw pi-pencil"},{label:"Poissons",icon:"pi pi-fw pi-calendar-times"},{label:"Fruits de mer",icon:"pi pi-fw pi-pencil"}]},{label:"Quit",icon:"pi pi-fw pi-power-off"}]}}},d=n(89);const m=(0,d.Z)(p,[["render",u]]);var g=m,f=(0,r.aZ)({name:"App",components:{HeaderComponent:g},methods:{navigateTo(e){this.$router.push({name:e})}}});const h=(0,d.Z)(f,[["render",i]]);var v=h,k=n(2483);const w=e=>((0,r.dD)("data-v-228bdc4e"),e=e(),(0,r.Cn)(),e),y=w((()=>(0,r._)("div",{class:"home"},[(0,r._)("div",{class:"home-card"},[(0,r._)("h2",null,"Bienvenue sur l'interface d'administration du marchand de poisson"),(0,r._)("p",null," Cette interface vous permet de gérer les stocks de produits de notre magasin. Vous pouvez ajouter ou retirer des produits en stock, modifier les prix et les promotions, voir le chiffre d'affaires, et d'autres fonctionnalités importantes. Utilisez les onglets de navigation en haut de la page pour accéder aux différentes fonctionnalités. ")])],-1)));function b(e,t,n,o,a,i){const c=(0,r.up)("HeaderComponent");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(c,{onNavigate:e.navigateTo},null,8,["onNavigate"]),y],64)}var _=(0,r.aZ)({name:"HomeView",components:{},methods:{navigateTo(e){this.$router.push({name:e})}}});const P=(0,d.Z)(_,[["render",b],["__scopeId","data-v-228bdc4e"]]);var S=P,I=n(7139);const C=(0,r._)("h1",null,"Liste des produits",-1),x={class:"productGrid"},q=(0,r._)("img",{alt:"user header",src:"/images/usercard.png"},null,-1);function j(e,t,n,o,a,i){const c=(0,r.up)("Button"),s=(0,r.up)("Card");return(0,r.wg)(),(0,r.iD)("div",null,[C,(0,r._)("ul",x,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(i.products,(e=>((0,r.wg)(),(0,r.iD)("li",{key:e.id},[(0,r.Wm)(s,{class:"cardProduct",style:{width:"25em"}},{header:(0,r.w5)((()=>[q])),title:(0,r.w5)((()=>[(0,r.Uk)((0,I.zw)(e.name),1)])),subtitle:(0,r.w5)((()=>[(0,r.Uk)((0,I.zw)(e.price)+" € ",1)])),content:(0,r.w5)((()=>[(0,r._)("p",null,(0,I.zw)(e.description),1)])),footer:(0,r.w5)((()=>[(0,r.Wm)(c,{icon:"pi pi-shopping-cart",rounded:""})])),_:2},1024)])))),128))])])}var z=n(65);n(2801);const D={token:null},T={setToken(e,t){e.token=t}},Z={},N={isAuthenticated(e){return!!e.token},getToken(e){return e.token}};var O={namespaced:!0,state:D,mutations:T,actions:Z,getters:N};function A(){const e=localStorage.getItem("token");if(e){const{exp:t}=JSON.parse(atob(e.split(".")[1]));return Date.now()<1e3*t}return!1}var H=(0,z.MT)({modules:{auth:O},state:{products:[]},mutations:{setProducts(e,t){e.products=t},updateQuantityStock(e,{productId:t,newQuantityInStock:n}){const o=e.products.find((e=>e.id===t));o&&(o.quantityInStock=n)},updateSalePercentage(e,t){const n=e.products.findIndex((e=>e.id===t.productId));-1!==n&&(e.products[n].promotion_percentage=t.newSalePercentage,e.products[n].price_on_sale=e.products[n].price*(1-t.newSalePercentage/100))}},actions:{async updateQuantityInStock(e,t){const{commit:n,state:o,rootGetters:r}=e,{productId:a,stockChange:i}=t,c=r["auth/getToken"];if(!c)return void console.error("Accès refusé. Veuillez vous connecter.");const s=o.products.find((e=>e.id===a));if(s){const e=s.quantityInStock+i;console.log("New quantity :",e,"Produit de quantité dans la table : ",s.quantityInStock,"Stockchange:",i);const t=await fetch(`http://127.0.0.1:8000/update_product_stock/${a}/`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({quantityInStock:e})});if(t.ok){const e=await t.json();console.log("Produit msie à jour après requete : "+e),n("updateQuantityStock",{productId:a,newQuantityInStock:e.quantityInStock}),s.quantityInStock=e.quantityInStock}else{const e=await t.json();console.error("Error updating product stock:",e)}}},async updateSalePercentage(e,t){const{commit:n,state:o,rootGetters:r}=e,{productId:a,salePercentage:i}=t,c=r["auth/getToken"];if(!c)return void console.error("Accès refusé. Veuillez vous connecter.");const s=o.products.find((e=>e.id===a));if(s){const e=parseInt(i.toString());console.log(e);const t=await fetch(`http://localhost:8000/update_sale_percentage/${a}/`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({sale:!0,discount:e})});if(t.ok){const e=await t.json();n("updateSalePercentage",{productId:a,newSalePercentage:e.sale_percentage})}else{const e=await t.json();console.error("Error updating product sale percentage:",e)}}},async fetchProducts({commit:e,rootGetters:t}){console.log("token recup : ",t["auth/getToken"]);const n=await fetch("http://localhost:8000/infoproducts",{headers:{Authorization:`Bearer ${t["auth/getToken"]}`}});if(n.ok){const t=await n.json();e("setProducts",t)}else console.error("Erreur lors de la récupération des produits.")}},getters:{getProducts(e){return e.products}}}),M=n(606),V={name:"ProductList",components:{Card:M.Z},computed:{products(){return H.getters.getProducts}},mounted(){H.dispatch("fetchProducts")}};const U=(0,d.Z)(V,[["render",j]]);var W=U;const L=e=>((0,r.dD)("data-v-271d6409"),e=e(),(0,r.Cn)(),e),Q={class:"product-details"},$={class:"dropdown-wrapper"},B={key:0,class:"product-info"},E=L((()=>(0,r._)("label",{for:"stock-change"},"Changer le stock :",-1))),J={key:0},G={key:0},R={key:1},Y=L((()=>(0,r._)("label",{for:"sale-percentage"},"Modifier le pourcentage de promotion :",-1))),F={key:0};function K(e,t,n,a,i,c){const s=(0,r.up)("Dropdown");return(0,r.wg)(),(0,r.iD)("div",Q,[(0,r._)("div",$,[(0,r.Wm)(s,{modelValue:e.selectedProduct,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.selectedProduct=t),t[1]||(t[1]=t=>e.displaySelectedProduct(t))],options:e.products,optionLabel:"name",placeholder:"Veuillez choisir un produit"},null,8,["modelValue","options"])]),e.selectedProduct?((0,r.wg)(),(0,r.iD)("div",B,[(0,r._)("div",null,[E,(0,r.wy)((0,r._)("input",{type:"number",id:"stock-change","onUpdate:modelValue":t[2]||(t[2]=t=>e.stockChange=t)},null,512),[[o.nr,e.stockChange,void 0,{number:!0}]]),(0,r._)("button",{onClick:t[3]||(t[3]=(...t)=>e.addStock&&e.addStock(...t)),style:{"margin-right":"10px","margin-top":"10px"}}," Ajouter article(s) "),(0,r._)("button",{onClick:t[4]||(t[4]=(...t)=>e.removeStock&&e.removeStock(...t)),style:{"margin-top":"10px"}}," Supprimer article(s) "),e.errorMessage?((0,r.wg)(),(0,r.iD)("p",J,(0,I.zw)(e.errorMessage),1)):(0,r.kq)("",!0)]),(0,r._)("h2",null,(0,I.zw)(e.selectedProduct.name),1),(0,r._)("p",null,"Prix: "+(0,I.zw)(e.selectedProduct.price)+" €",1),e.selectedProduct.price_on_sale?((0,r.wg)(),(0,r.iD)("p",G," Prix en promotion: "+(0,I.zw)(e.selectedProduct.price_on_sale)+" € ",1)):(0,r.kq)("",!0),e.selectedProduct.promotion_percentage?((0,r.wg)(),(0,r.iD)("p",R," Pourcentage de promotion: "+(0,I.zw)(e.selectedProduct.promotion_percentage)+"% ",1)):(0,r.kq)("",!0),(0,r._)("p",null,"Quantité en stock: "+(0,I.zw)(e.selectedProduct.quantityInStock),1),(0,r._)("p",null,"Nombre d'articles vendus: "+(0,I.zw)(e.selectedProduct.sold_count),1),(0,r._)("p",null,"Commentaires: "+(0,I.zw)(e.selectedProduct.comments),1),(0,r._)("div",null,[Y,(0,r.wy)((0,r._)("input",{type:"number",id:"sale-percentage","onUpdate:modelValue":t[5]||(t[5]=t=>e.salePercentage=t)},null,512),[[o.nr,e.salePercentage,void 0,{number:!0}]]),(0,r.Uk)(" % "),(0,r._)("button",{onClick:t[6]||(t[6]=(...t)=>e.updateSalePercentage&&e.updateSalePercentage(...t)),style:{"margin-right":"10px","margin-top":"10px"}}," Mettre à jour promotion "),e.errorMessage?((0,r.wg)(),(0,r.iD)("div",F,(0,I.zw)(e.errorMessage),1)):(0,r.kq)("",!0)])])):(0,r.kq)("",!0)])}var X=n(4870),ee=(0,r.aZ)({name:"ProductDetails",setup(){const e=(0,z.oR)(),t=(0,X.iH)(null),n=(0,X.iH)([]),o=(0,X.iH)(0),a=(0,X.iH)(0),i=(0,X.iH)("");function c(e){t.value=e}function s(){if(!t.value)return;const n=parseInt(a.value.toString()),o=t.value;isNaN(n)||n<1?i.value="Veuillez entrer un nombre positif.":o.quantityInStock+n>1e3?i.value="Le stock maximal est atteint.":(e.dispatch("updateQuantityInStock",{productId:o.id,stockChange:n}),o.quantityInStock=Math.min(o.quantityInStock+n,1e3),t.value={...o},i.value="")}function u(){if(!t.value)return;const n=-parseInt(a.value.toString()),o=t.value;isNaN(n)||n>1?i.value="Veuillez entrer un nombre negatif.":o.quantityInStock+n<0?i.value="Le stock minimal est 0.":(e.dispatch("updateQuantityInStock",{productId:o.id,stockChange:n}),o.quantityInStock=Math.min(o.quantityInStock+n),t.value={...o},i.value="")}function l(){if(!t.value)return;const n=parseInt(o.value.toString());isNaN(n)||n<0||n>100?i.value="Veuillez entrer un pourcentage entre 0 et 100.":(e.dispatch("updateSalePercentage",{productId:t.value.id,salePercentage:n}),i.value="")}return e.dispatch("fetchProducts"),(0,r.YP)((()=>e.getters.getProducts),(e=>{n.value=e})),{products:n,selectedProduct:t,displaySelectedProduct:c,stockChange:a,salePercentage:o,updateSalePercentage:l,errorMessage:i,addStock:s,removeStock:u}}});const te=(0,d.Z)(ee,[["render",K],["__scopeId","data-v-271d6409"]]);var ne=te;const oe=e=>((0,r.dD)("data-v-3a8e18b3"),e=e(),(0,r.Cn)(),e),re={class:"login-container"},ae={class:"p-card login-card"},ie=oe((()=>(0,r._)("h2",{class:"p-text-center"},"Connexion",-1))),ce={class:"p-fluid"},se={class:"p-field p-mt-4"},ue=oe((()=>(0,r._)("label",{for:"username"},"Nom d'utilisateur",-1))),le={class:"p-field p-mt-4"},pe=oe((()=>(0,r._)("label",{for:"password"},"Mot de passe",-1))),de={class:"login-card flex justify-content-center"},me={class:"clear-card flex justify-content"};function ge(e,t,n,a,i,c){const s=(0,r.up)("Button");return(0,r.wg)(),(0,r.iD)("div",re,[(0,r._)("div",ae,[ie,(0,r._)("div",ce,[(0,r._)("div",se,[ue,(0,r.wy)((0,r._)("input",{type:"text",id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>a.username=e),class:"p-inputtext p-component p-filled"},null,512),[[o.nr,a.username]])]),(0,r._)("div",le,[pe,(0,r.wy)((0,r._)("input",{type:"password",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>a.password=e),class:"p-inputtext p-component p-filled"},null,512),[[o.nr,a.password]])]),(0,r._)("div",null,[(0,r._)("div",de,[(0,r.Wm)(s,{type:"button",label:"Se connecter",icon:"pi pi-user",onClick:a.login},null,8,["onClick"])]),(0,r._)("div",me,[(0,r.Wm)(s,{class:"clearbtn",label:"Effacer",onClick:a.clear,link:""},null,8,["onClick"])])])])])])}var fe={setup(){const e=(0,z.oR)(),t=(0,k.tv)(),n=(0,k.yj)(),o=(0,X.iH)(""),r=(0,X.iH)(""),a=async()=>{const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o.value,password:r.value})};try{const o=await fetch("http://localhost:8000/api/token/",a);if(!o.ok)throw new Error("Nom d'utilisateur ou mot de passe incorrect.");const r=await o.json();e.commit("auth/setToken",r.access),localStorage.setItem("token",r.access),console.log("Token stored:",r.access),t.replace(n.query.redirect||"/")}catch(i){console.log(i),alert(i.message)}},i=()=>{o.value="",r.value=""};return{username:o,password:r,login:a,clear:i}}};const he=(0,d.Z)(fe,[["render",ge],["__scopeId","data-v-3a8e18b3"]]);var ve=he;const ke={class:"card flex justify-content-center"};function we(e,t){const n=(0,r.up)("Image");return(0,r.wg)(),(0,r.iD)("div",ke,[(0,r.Wm)(n,{src:"https://primefaces.org/cdn/primevue/images/galleria/galleria10.jpg",alt:"Image",width:"250",preview:""})])}const ye={},be=(0,d.Z)(ye,[["render",we]]);var _e=be;const Pe=[{path:"/",name:"homeLogin",component:S,meta:{requiresAuth:!0}},{path:"/product-details",name:"ProductDetails",component:ne,props:!0},{path:"/product-list",name:"ProductList",component:W,props:!0},{path:"/login",name:"login",component:ve},{path:"/test",name:"test",component:_e,meta:{requiresAuth:!0}}],Se=(0,k.p7)({history:(0,k.PO)("/"),routes:Pe});Se.beforeEach(((e,t,n)=>{e.matched.some((e=>e.meta.requiresAuth))?A()?(console.log("User est connecté. Accès autorisé."),n()):(console.log("User n'est pas connecté. Redirection à la page login."),n({path:"/login",query:{redirect:e.fullPath}})):(console.log("Authentification non requise. Accès autorisé."),n())}));var Ie=Se,Ce=n(7729),xe=n(6709),qe=n(5517),je=n(1826),ze=n(9827),De=n(1583),Te=n(1489),Ze=n(8932);const Ne=localStorage.getItem("token");Ne&&H.commit("auth/setToken",Ne),(0,o.ri)(v).use(H).use(Ie).use(Ce.Z).component("InputText",xe.Z).component("Button",je.Z).component("Card",M.Z).component("AutoComplete",ze.Z).component("InputNumber",De.Z).component("Dropdown",qe.Z).component("Image",Te.Z).component("vue-next-select",Ze.Z).mount("#app")}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,o,r,a){if(!o){var i=1/0;for(l=0;l<e.length;l++){o=e[l][0],r=e[l][1],a=e[l][2];for(var c=!0,s=0;s<o.length;s++)(!1&a||i>=a)&&Object.keys(n.O).every((function(e){return n.O[e](o[s])}))?o.splice(s--,1):(c=!1,a<i&&(i=a));if(c){e.splice(l--,1);var u=r();void 0!==u&&(t=u)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[o,r,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,a,i=o[0],c=o[1],s=o[2],u=0;if(i.some((function(t){return 0!==e[t]}))){for(r in c)n.o(c,r)&&(n.m[r]=c[r]);if(s)var l=s(n)}for(t&&t(o);u<i.length;u++)a=i[u],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(l)},o=self["webpackChunkdbo_backoffice"]=self["webpackChunkdbo_backoffice"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(5785)}));o=n.O(o)})();
//# sourceMappingURL=app.62cd0a26.js.map